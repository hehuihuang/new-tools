# 财税计算工具套件实施计划

## 任务列表

- [x] 1. 创建项目结构和共享基础设施


  - 创建finance-tools目录和shared子目录
  - 设置基础的HTML模板结构
  - _需求: 7.1, 7.2_


- [x] 1.1 实现共享样式系统 (styles.css)


  - 基于现有text-tools的样式系统创建财税工具的样式
  - 使用蓝色主题配色方案，避免紫色渐变
  - 实现响应式布局和卡片式设计
  - 添加输入表单、按钮、结果展示的样式
  - _需求: 7.1, 7.4, 7.5_



- [x] 1.2 实现共享UI组件 (components.js)


  - 实现createFinanceHeader()函数
  - 实现createInputGroup()函数
  - 实现createResultCard()函数
  - 实现createComparisonTable()函数
  - 实现createDetailsList()函数


  - 实现showMessage()函数（成功/错误提示）
  - _需求: 7.2, 9.1_

- [x] 1.3 实现共享工具函数 (utils.js)


  - 实现formatCurrency()货币格式化函数
  - 实现formatPercent()百分比格式化函数
  - 实现validateNumber()数字验证函数


  - 实现saveToHistory()历史记录保存函数
  - 实现loadHistory()历史记录加载函数
  - 实现clearHistory()历史记录清除函数

  - _需求: 8.1, 8.2, 10.1, 10.3, 10.5_

- [x] 1.4 编写共享工具函数的单元测试



  - 测试formatCurrency()的各种金额格式化

  - 测试validateNumber()的输入验证逻辑
  - 测试历史记录的保存、加载、清除功能
  - _需求: 8.1, 8.2, 10.1, 10.3, 10.5_

- [-] 2. 实现核心计算引擎 (calculators.js)

  - 创建TaxCalculator基类
  - 定义税率表常量（个税、增值税、企业所得税）
  - _需求: 1.5, 3.5, 4.3_

- [x] 2.1 实现个人所得税计算函数

  - 实现calculateIndividualTax()函数
  - 实现税率表查找逻辑
  - 实现应纳税所得额和应纳税额计算
  - 返回详细的计算步骤
  - _需求: 2.1, 2.2, 2.3, 2.5, 6.3_

- [x] 2.2 编写个税计算的属性测试

  - **属性 6: 个税税率表应用正确性**

  - **验证需求: 2.3**

- [x] 2.3 编写个税计算的属性测试

  - **属性 5: 应纳税所得额计算正确性**
  - **验证需求: 2.2**


- [ ] 2.4 编写个税计算的属性测试
  - **属性 21: 工资应纳税所得额计算正确性**
  - **验证需求: 6.3**

- [x] 2.5 实现年终奖个税计算函数

  - 实现calculateBonusTax()函数
  - 实现单独计税方式计算
  - 实现并入综合所得方式计算
  - 实现两种方式的对比逻辑
  - _需求: 1.1, 1.2, 1.3_

- [x] 2.6 编写年终奖计算的属性测试

  - **属性 1: 年终奖单独计税计算正确性**
  - **验证需求: 1.1**


- [ ] 2.7 编写年终奖计算的属性测试
  - **属性 2: 年终奖并入综合所得计算正确性**

  - **验证需求: 1.2**

- [ ] 2.8 编写年终奖计算的属性测试
  - **属性 3: 年终奖计税方式对比完整性**
  - **验证需求: 1.3**

- [x] 2.9 实现增值税计算函数

  - 实现calculateVAT()函数
  - 实现含税/不含税金额转换
  - 实现一般纳税人和小规模纳税人计算
  - 实现进项税额抵扣逻辑

  - _需求: 3.1, 3.2, 3.3, 3.4_

- [ ] 2.10 编写增值税计算的属性测试
  - **属性 8: 含税转不含税计算正确性**
  - **验证需求: 3.2**



- [x] 2.11 编写增值税计算的属性测试

  - **属性 9: 增值税往返一致性**
  - **验证需求: 3.2, 3.3**

- [ ] 2.12 编写增值税计算的属性测试
  - **属性 10: 一般纳税人增值税计算正确性**

  - **验证需求: 3.4**

- [ ] 2.13 编写增值税计算的属性测试
  - **属性 11: 增值税税率应用正确性**
  - **验证需求: 3.1, 3.5**

- [x] 2.14 实现企业所得税计算函数

  - 实现calculateCorporateTax()函数
  - 实现利润总额计算
  - 实现应纳税所得额调整
  - 实现小微企业优惠税率计算
  - 实现税负率计算

  - _需求: 4.1, 4.2, 4.3, 4.4, 4.5_

- [ ] 2.15 编写企业所得税计算的属性测试
  - **属性 12: 利润总额计算正确性**

  - **验证需求: 4.1**


- [ ] 2.16 编写企业所得税计算的属性测试
  - **属性 13: 应纳税所得额调整正确性**

  - **验证需求: 4.2**

- [ ] 2.17 编写企业所得税计算的属性测试
  - **属性 14: 企业所得税税率应用正确性**

  - **验证需求: 4.3**

- [ ] 2.18 编写企业所得税计算的属性测试
  - **属性 15: 小微企业优惠计算正确性**
  - **验证需求: 4.4**

- [x] 2.19 实现房贷还款计算函数

  - 实现calculateMortgage()函数
  - 实现等额本息月供计算
  - 实现等额本金月供计算
  - 实现还款计划表生成

  - 实现总利息和还款总额计算
  - _需求: 5.1, 5.2, 5.3, 5.4_

- [ ] 2.20 编写房贷计算的属性测试
  - **属性 16: 等额本息月供计算正确性**


  - **验证需求: 5.1**

- [x] 2.21 编写房贷计算的属性测试

  - **属性 17: 等额本金月供计算正确性**
  - **验证需求: 5.2**


- [ ] 2.22 编写房贷计算的属性测试
  - **属性 18: 还款总额一致性**
  - **验证需求: 5.3**

- [ ] 2.23 编写房贷计算的属性测试
  - **属性 19: 还款计划表完整性**
  - **验证需求: 5.4**

- [x] 2.24 实现工资个税相关计算函数

  - 实现五险一金计算函数

  - 实现专项附加扣除计算
  - 实现税后工资计算
  - _需求: 6.1, 6.2, 6.4_


- [ ] 2.25 编写工资个税计算的属性测试
  - **属性 20: 五险一金计算正确性**
  - **验证需求: 6.1**

- [ ] 2.26 编写工资个税计算的属性测试
  - **属性 22: 税后工资计算正确性**
  - **验证需求: 6.4**


- [ ] 3. 检查点 - 确保所有测试通过
  - 确保所有测试通过，如有问题请询问用户

- [-] 4. 实现年终奖个税计算器页面 (bonus-tax.html)

  - 创建HTML页面结构
  - 集成共享组件和样式
  - 实现输入表单（年终奖金额、年度综合所得）
  - 实现计税方式选择（单独/并入）
  - 实现计算按钮和事件处理
  - 实现结果展示（两种方式对比）
  - 实现详细计算过程展示
  - 实现历史记录功能
  - _需求: 1.1, 1.2, 1.3, 1.4, 1.5_

- [ ] 4.1 编写年终奖页面的属性测试
  - **属性 23: 无效输入拒绝**
  - **验证需求: 1.4, 8.1**

- [ ] 4.2 编写年终奖页面的属性测试
  - **属性 29: 计算结果完整性**
  - **验证需求: 9.1**

- [ ] 5. 实现综合所得汇算计算器页面 (income-tax.html)
  - 创建HTML页面结构
  - 实现收入输入表单（工资薪金、劳务报酬、稿酬、特许权使用费）
  - 实现扣除项输入表单（专项扣除、专项附加扣除、其他扣除）
  - 实现已预缴税额输入
  - 实现计算按钮和事件处理
  - 实现结果展示（应纳税额、应补退税额）
  - 实现详细计算过程展示
  - 实现历史记录功能
  - _需求: 2.1, 2.2, 2.3, 2.4, 2.5_

- [ ] 5.1 编写综合所得页面的属性测试
  - **属性 4: 综合所得总额计算正确性**
  - **验证需求: 2.1**

- [ ] 5.2 编写综合所得页面的属性测试
  - **属性 7: 补退税额计算正确性**
  - **验证需求: 2.4**

- [ ] 5.3 编写综合所得页面的属性测试
  - **属性 30: 计算步骤可追溯性**
  - **验证需求: 2.5, 9.3**

- [ ] 6. 实现增值税计算器页面 (vat-calculator.html)
  - 创建HTML页面结构
  - 实现纳税人类型选择（一般纳税人/小规模纳税人）
  - 实现金额输入和含税/不含税选择
  - 实现税率选择（13%/9%/6%/3%/1%）
  - 实现进项税额输入（一般纳税人）
  - 实现计算按钮和事件处理
  - 实现结果展示（不含税金额、税额、应纳税额）
  - 实现详细计算过程展示
  - 实现历史记录功能
  - _需求: 3.1, 3.2, 3.3, 3.4, 3.5_

- [ ] 6.1 编写增值税页面的属性测试
  - **属性 24: 范围验证正确性**
  - **验证需求: 8.2**

- [ ] 7. 实现企业所得税计算器页面 (corp-tax.html)
  - 创建HTML页面结构
  - 实现收入成本输入表单
  - 实现纳税调整项输入表单
  - 实现企业类型选择（一般企业/小微企业/高新技术企业）
  - 实现计算按钮和事件处理
  - 实现结果展示（利润总额、应纳税所得额、应纳税额、税负率）
  - 实现详细计算过程展示
  - 实现历史记录功能
  - _需求: 4.1, 4.2, 4.3, 4.4, 4.5_

- [ ] 7.1 编写企业所得税页面的属性测试
  - **属性 25: 必填字段验证**
  - **验证需求: 8.3**

- [ ] 8. 实现房贷还款计算器页面 (mortgage.html)
  - 创建HTML页面结构
  - 实现贷款参数输入表单（本金、期限、利率）
  - 实现还款方式选择（等额本息/等额本金）
  - 实现贷款类型选择（商业/公积金/组合）
  - 实现计算按钮和事件处理
  - 实现结果展示（月供、总利息、还款总额）
  - 实现还款计划表展示（可折叠）
  - 实现历史记录功能
  - _需求: 5.1, 5.2, 5.3, 5.4, 5.5_

- [ ] 8.1 编写房贷页面的属性测试
  - **属性 26: 历史记录保存一致性**
  - **验证需求: 10.1, 10.4**

- [ ] 9. 实现工资个税计算器页面 (salary-tax.html)
  - 创建HTML页面结构
  - 实现税前工资输入
  - 实现五险一金参数输入（缴纳比例、基数）
  - 实现专项附加扣除输入（子女教育、继续教育、住房贷款利息等）
  - 实现计算按钮和事件处理
  - 实现结果展示（五险一金、应纳税额、税后工资）
  - 实现详细计算过程展示
  - 实现历史记录功能
  - _需求: 6.1, 6.2, 6.3, 6.4, 6.5_

- [ ] 9.1 编写工资个税页面的属性测试
  - **属性 27: 历史记录数量限制**
  - **验证需求: 10.3**

- [ ] 9.2 编写工资个税页面的属性测试
  - **属性 28: 历史记录清除完整性**
  - **验证需求: 10.5**

- [x] 10. 更新导航页面集成


  - 更新tooles/index.html中的财税工具链接
  - 将占位符链接替换为实际的计算器页面链接
  - 确保所有链接正确跳转
  - _需求: 7.2_

- [ ] 11. 最终检查点 - 确保所有测试通过
  - 确保所有测试通过，如有问题请询问用户

## 任务说明

### 开发顺序
1. 首先建立共享基础设施（样式、组件、工具函数）
2. 然后实现核心计算引擎，并为每个计算函数编写属性测试
3. 最后实现各个计算器页面，集成计算引擎和UI组件

### 测试策略
- 所有单元测试和属性测试都是必需的，确保代码质量和正确性
- 属性测试使用fast-check库，每个测试至少运行100次迭代
- 每个属性测试必须标注对应的属性编号和验证的需求

### 代码质量
- 所有计算函数必须包含详细的JSDoc注释
- 所有计算结果必须包含计算步骤（steps数组）
- 所有用户输入必须进行验证
- 所有错误必须有友好的错误消息

### UI一致性
- 所有页面使用相同的布局结构
- 所有页面使用相同的配色方案（蓝色主题）
- 所有页面使用相同的交互模式
- 所有页面在移动端保持良好的响应式布局
