<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>æ–‡æœ¬ç»Ÿè®¡ - åœ¨çº¿å·¥å…·ç®±</title>
  <link rel="stylesheet" href="shared/styles.css">
  <style>
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
      margin-top: 15px;
    }
    .stat-card {
      background: #f5f5f5;
      padding: 15px;
      border-radius: 8px;
      text-align: center;
    }
    .stat-value {
      font-size: 32px;
      font-weight: bold;
      color: #2196F3;
      margin: 10px 0;
    }
    .stat-label {
      font-size: 14px;
      color: #666;
    }
    .freq-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 15px;
      max-height: 300px;
      overflow-y: auto;
      display: block;
    }
    .freq-table thead {
      position: sticky;
      top: 0;
      background: #fff;
    }
    .freq-table th,
    .freq-table td {
      padding: 8px;
      text-align: left;
      border-bottom: 1px solid #ddd;
    }
    .freq-table th {
      background: #2196F3;
      color: white;
      font-weight: 500;
    }
    .freq-table tr:hover {
      background: #f5f5f5;
    }
  </style>
</head>
<body>
  <div class="container">
    <header class="header">
      <a href="../tooles/index.html" class="back-link">â† è¿”å›å·¥å…·ç®±</a>
      <h1>æ–‡æœ¬ç»Ÿè®¡å·¥å…·</h1>
      <p>å®æ—¶ç»Ÿè®¡å­—æ•°ã€å•è¯ã€å¥å­ã€è¡Œæ•°å’Œå­—ç¬¦é¢‘ç‡</p>
      <div class="privacy-notice">ğŸ”’ æ‰€æœ‰å¤„ç†å‡åœ¨æœ¬åœ°å®Œæˆï¼Œæ•°æ®ä¸ä¼šä¸Šä¼ </div>
    </header>

    <div class="card">
      <div class="card-title">è¾“å…¥æ–‡æœ¬</div>
      <div class="editor-container">
        <textarea id="input" class="editor" placeholder="åœ¨æ­¤è¾“å…¥æˆ–ç²˜è´´æ–‡æœ¬ï¼Œç»Ÿè®¡ä¿¡æ¯å°†å®æ—¶æ›´æ–°..." oninput="updateStatistics()"></textarea>
      </div>
      <div class="btn-group">
        <button class="btn btn-secondary" onclick="clearInput()">æ¸…ç©º</button>
      </div>
    </div>

    <div class="card">
      <div class="card-title">ç»Ÿè®¡ä¿¡æ¯</div>
      <div class="stats-grid" id="statsGrid">
        <div class="stat-card">
          <div class="stat-label">å­—ç¬¦æ•°ï¼ˆå«ç©ºæ ¼ï¼‰</div>
          <div class="stat-value" id="charCount">0</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">å­—ç¬¦æ•°ï¼ˆä¸å«ç©ºæ ¼ï¼‰</div>
          <div class="stat-value" id="charCountNoSpace">0</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">å•è¯æ•°</div>
          <div class="stat-value" id="wordCount">0</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">å¥å­æ•°</div>
          <div class="stat-value" id="sentenceCount">0</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">è¡Œæ•°</div>
          <div class="stat-value" id="lineCount">0</div>
        </div>
      </div>
    </div>

    <div class="card">
      <div class="card-title">å­—ç¬¦é¢‘ç‡åˆ†æ</div>
      <div style="overflow-x: auto;">
        <table class="freq-table" id="freqTable">
          <thead>
            <tr>
              <th>å­—ç¬¦</th>
              <th>å‡ºç°æ¬¡æ•°</th>
              <th>å æ¯”</th>
            </tr>
          </thead>
          <tbody id="freqTableBody">
            <tr>
              <td colspan="3" style="text-align: center; color: #999;">è¾“å…¥æ–‡æœ¬åæ˜¾ç¤ºå­—ç¬¦é¢‘ç‡</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <script type="module">
    import { showMessage } from './shared/components.js';

    window.showMessage = showMessage;

    /**
     * è®¡ç®—ç»Ÿè®¡ä¿¡æ¯
     */
    function calculateStats(text) {
      if (!text) {
        return {
          charCount: 0,
          charCountNoSpace: 0,
          wordCount: 0,
          sentenceCount: 0,
          lineCount: 0,
          charFrequency: new Map()
        };
      }

      // å­—ç¬¦æ•°
      const charCount = text.length;
      const charCountNoSpace = text.replace(/\s/g, '').length;

      // å•è¯æ•°
      const words = text.trim().split(/\s+/).filter(w => w.length > 0);
      const wordCount = words.length;

      // å¥å­æ•°ï¼ˆåŸºäºå¥å·ã€é—®å·ã€æ„Ÿå¹å·ï¼‰
      const sentences = text.split(/[.!?ã€‚ï¼ï¼Ÿ]+/).filter(s => s.trim().length > 0);
      const sentenceCount = sentences.length;

      // è¡Œæ•°
      const lines = text.split(/\r?\n/);
      const lineCount = lines.length;

      // å­—ç¬¦é¢‘ç‡
      const charFrequency = getCharFrequency(text);

      return {
        charCount,
        charCountNoSpace,
        wordCount,
        sentenceCount,
        lineCount,
        charFrequency
      };
    }

    /**
     * è·å–å­—ç¬¦é¢‘ç‡
     */
    function getCharFrequency(text) {
      const frequency = new Map();
      
      for (const char of text) {
        frequency.set(char, (frequency.get(char) || 0) + 1);
      }
      
      return frequency;
    }

    /**
     * æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
     */
    window.updateStatistics = function() {
      const input = document.getElementById('input').value;
      const stats = calculateStats(input);

      // æ›´æ–°ç»Ÿè®¡å¡ç‰‡
      document.getElementById('charCount').textContent = stats.charCount;
      document.getElementById('charCountNoSpace').textContent = stats.charCountNoSpace;
      document.getElementById('wordCount').textContent = stats.wordCount;
      document.getElementById('sentenceCount').textContent = stats.sentenceCount;
      document.getElementById('lineCount').textContent = stats.lineCount;

      // æ›´æ–°å­—ç¬¦é¢‘ç‡è¡¨
      updateFrequencyTable(stats.charFrequency, stats.charCount);
    };

    /**
     * æ›´æ–°å­—ç¬¦é¢‘ç‡è¡¨
     */
    function updateFrequencyTable(frequency, total) {
      const tbody = document.getElementById('freqTableBody');
      
      if (frequency.size === 0) {
        tbody.innerHTML = '<tr><td colspan="3" style="text-align: center; color: #999;">è¾“å…¥æ–‡æœ¬åæ˜¾ç¤ºå­—ç¬¦é¢‘ç‡</td></tr>';
        return;
      }

      // è½¬æ¢ä¸ºæ•°ç»„å¹¶æ’åº
      const sortedFreq = Array.from(frequency.entries())
        .sort((a, b) => b[1] - a[1])
        .slice(0, 50); // åªæ˜¾ç¤ºå‰50ä¸ª

      tbody.innerHTML = sortedFreq.map(([char, count]) => {
        const percentage = ((count / total) * 100).toFixed(2);
        const displayChar = char === ' ' ? 'ç©ºæ ¼' : char === '\n' ? 'æ¢è¡Œ' : char === '\t' ? 'åˆ¶è¡¨ç¬¦' : char;
        return `
          <tr>
            <td><code>${displayChar}</code></td>
            <td>${count}</td>
            <td>${percentage}%</td>
          </tr>
        `;
      }).join('');
    }

    window.clearInput = function() {
      document.getElementById('input').value = '';
      updateStatistics();
    };

    // å¯¼å‡ºä¾›æµ‹è¯•ä½¿ç”¨
    window.calculateStats = calculateStats;
    window.getCharFrequency = getCharFrequency;
  </script>
</body>
</html>
