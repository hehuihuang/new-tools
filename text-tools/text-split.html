<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>æ–‡æœ¬åˆ†å‰²åˆå¹¶ - åœ¨çº¿å·¥å…·ç®±</title>
  <link rel="stylesheet" href="shared/styles.css">
</head>
<body>
  <div class="container">
    <header class="header">
      <a href="../tooles/index.html" class="back-link">â† è¿”å›å·¥å…·ç®±</a>
      <h1>æ–‡æœ¬åˆ†å‰²/åˆå¹¶å·¥å…·</h1>
      <p>ä½¿ç”¨è‡ªå®šä¹‰åˆ†éš”ç¬¦åˆ†å‰²æˆ–åˆå¹¶æ–‡æœ¬ï¼Œçµæ´»è½¬æ¢æ–‡æœ¬æ ¼å¼</p>
      <div class="privacy-notice">ğŸ”’ æ‰€æœ‰å¤„ç†å‡åœ¨æœ¬åœ°å®Œæˆï¼Œæ•°æ®ä¸ä¼šä¸Šä¼ </div>
    </header>

    <div class="card">
      <div class="card-title">æ“ä½œæ¨¡å¼</div>
      <div class="options-group">
        <div class="option-item">
          <input type="radio" name="mode" id="mode-split" value="split" checked>
          <label for="mode-split">åˆ†å‰²æ–‡æœ¬</label>
        </div>
        <div class="option-item">
          <input type="radio" name="mode" id="mode-join" value="join">
          <label for="mode-join">åˆå¹¶æ–‡æœ¬</label>
        </div>
      </div>
    </div>

    <div class="card">
      <div class="card-title">åˆ†éš”ç¬¦é€‰æ‹©</div>
      <div class="options-group">
        <div class="option-item">
          <input type="radio" name="delimiter" id="delim-comma" value="," checked>
          <label for="delim-comma">é€—å· (,)</label>
        </div>
        <div class="option-item">
          <input type="radio" name="delimiter" id="delim-space" value=" ">
          <label for="delim-space">ç©ºæ ¼</label>
        </div>
        <div class="option-item">
          <input type="radio" name="delimiter" id="delim-newline" value="\n">
          <label for="delim-newline">æ¢è¡Œ</label>
        </div>
        <div class="option-item">
          <input type="radio" name="delimiter" id="delim-tab" value="\t">
          <label for="delim-tab">åˆ¶è¡¨ç¬¦ (Tab)</label>
        </div>
        <div class="option-item">
          <input type="radio" name="delimiter" id="delim-pipe" value="|">
          <label for="delim-pipe">ç«–çº¿ (|)</label>
        </div>
        <div class="option-item">
          <input type="radio" name="delimiter" id="delim-custom" value="custom">
          <label for="delim-custom">è‡ªå®šä¹‰</label>
        </div>
      </div>
      <div style="margin-top: 10px;">
        <input type="text" id="customDelimiter" class="input" placeholder="è¾“å…¥è‡ªå®šä¹‰åˆ†éš”ç¬¦" style="width: 100%;" disabled>
      </div>
    </div>

    <div class="dual-editor">
      <div class="card">
        <div class="card-title">è¾“å…¥æ–‡æœ¬</div>
        <div class="editor-container">
          <textarea id="input" class="editor" placeholder="åœ¨æ­¤è¾“å…¥æˆ–ç²˜è´´æ–‡æœ¬..."></textarea>
        </div>
        <div class="btn-group">
          <button class="btn btn-primary" onclick="processText()">å¤„ç†</button>
          <button class="btn btn-secondary" onclick="clearInput()">æ¸…ç©º</button>
        </div>
      </div>

      <div class="card">
        <div class="card-title">å¤„ç†ç»“æœ</div>
        <div class="editor-container">
          <textarea id="output" class="editor" readonly placeholder="å¤„ç†ç»“æœå°†æ˜¾ç¤ºåœ¨è¿™é‡Œ..."></textarea>
        </div>
        <div class="btn-group">
          <button class="btn btn-success" onclick="copyResult()">å¤åˆ¶ç»“æœ</button>
        </div>
        <div id="stats" class="stats"></div>
      </div>
    </div>
  </div>

  <script type="module">
    import { showMessage, copyToClipboard, updateStats } from './shared/components.js';

    window.showMessage = showMessage;
    window.copyToClipboard = copyToClipboard;
    window.updateStats = updateStats;

    /**
     * åˆ†å‰²æ–‡æœ¬
     */
    function splitText(text, delimiter) {
      if (!text) return [];
      
      // å¤„ç†ç‰¹æ®Šåˆ†éš”ç¬¦
      let actualDelimiter = delimiter;
      if (delimiter === '\\n') {
        actualDelimiter = '\n';
      } else if (delimiter === '\\t') {
        actualDelimiter = '\t';
      }
      
      return text.split(actualDelimiter);
    }

    /**
     * åˆå¹¶æ–‡æœ¬
     */
    function joinText(text, delimiter) {
      // æŒ‰è¡Œåˆ†å‰²è¾“å…¥
      const lines = text.split(/\r?\n/).filter(line => line.length > 0);
      
      // å¤„ç†ç‰¹æ®Šåˆ†éš”ç¬¦
      let actualDelimiter = delimiter;
      if (delimiter === '\\n') {
        actualDelimiter = '\n';
      } else if (delimiter === '\\t') {
        actualDelimiter = '\t';
      }
      
      return lines.join(actualDelimiter);
    }

    /**
     * è·å–å½“å‰åˆ†éš”ç¬¦
     */
    function getCurrentDelimiter() {
      const delimiterRadio = document.querySelector('input[name="delimiter"]:checked');
      if (delimiterRadio.value === 'custom') {
        return document.getElementById('customDelimiter').value;
      }
      return delimiterRadio.value;
    }

    /**
     * å¤„ç†æ–‡æœ¬
     */
    window.processText = function() {
      const input = document.getElementById('input').value;
      const mode = document.querySelector('input[name="mode"]:checked').value;
      const delimiter = getCurrentDelimiter();
      
      if (!input.trim()) {
        showMessage('error', 'è¯·è¾“å…¥è¦å¤„ç†çš„æ–‡æœ¬');
        return;
      }
      
      if (!delimiter) {
        showMessage('error', 'è¯·è¾“å…¥è‡ªå®šä¹‰åˆ†éš”ç¬¦');
        return;
      }
      
      let result;
      let stats;
      
      if (mode === 'split') {
        const parts = splitText(input, delimiter);
        result = parts.join('\n');
        stats = {
          'æ“ä½œ': 'åˆ†å‰²',
          'åˆ†éš”ç¬¦': delimiter === '\n' ? 'æ¢è¡Œ' : delimiter === '\t' ? 'åˆ¶è¡¨ç¬¦' : delimiter,
          'åˆ†å‰²æ•°é‡': parts.length
        };
      } else {
        result = joinText(input, delimiter);
        const lines = input.split(/\r?\n/).filter(line => line.length > 0);
        stats = {
          'æ“ä½œ': 'åˆå¹¶',
          'åˆ†éš”ç¬¦': delimiter === '\n' ? 'æ¢è¡Œ' : delimiter === '\t' ? 'åˆ¶è¡¨ç¬¦' : delimiter,
          'åˆå¹¶è¡Œæ•°': lines.length
        };
      }
      
      document.getElementById('output').value = result;
      updateStats(stats, document.getElementById('stats'));
      showMessage('success', 'å¤„ç†å®Œæˆ');
    };

    window.clearInput = function() {
      document.getElementById('input').value = '';
      document.getElementById('output').value = '';
      document.getElementById('stats').innerHTML = '';
    };

    window.copyResult = function() {
      const output = document.getElementById('output').value;
      if (!output) {
        showMessage('error', 'æ²¡æœ‰å¯å¤åˆ¶çš„å†…å®¹');
        return;
      }
      copyToClipboard(output);
    };

    // ç›‘å¬è‡ªå®šä¹‰åˆ†éš”ç¬¦é€‰é¡¹
    document.querySelectorAll('input[name="delimiter"]').forEach(radio => {
      radio.addEventListener('change', function() {
        const customInput = document.getElementById('customDelimiter');
        if (this.value === 'custom') {
          customInput.disabled = false;
          customInput.focus();
        } else {
          customInput.disabled = true;
        }
      });
    });

    // å¯¼å‡ºä¾›æµ‹è¯•ä½¿ç”¨
    window.splitText = splitText;
    window.joinText = joinText;
  </script>
</body>
</html>
