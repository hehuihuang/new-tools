<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>æ–‡æœ¬æŸ¥æ‰¾æ›¿æ¢ - åœ¨çº¿å·¥å…·ç®±</title>
  <link rel="stylesheet" href="shared/styles.css">
  <style>
    .search-options {
      display: flex;
      gap: 15px;
      margin-top: 10px;
    }
    .highlight {
      background-color: #ffeb3b;
      padding: 2px 4px;
      border-radius: 2px;
    }
  </style>
</head>
<body>
  <div class="container">
    <header class="header">
      <a href="../tooles/index.html" class="back-link">â† è¿”å›å·¥å…·ç®±</a>
      <h1>æ–‡æœ¬æŸ¥æ‰¾æ›¿æ¢å·¥å…·</h1>
      <p>æ”¯æŒå…³é”®å­—å’Œæ­£åˆ™è¡¨è¾¾å¼æŸ¥æ‰¾æ›¿æ¢ï¼Œæ‰¹é‡ä¿®æ”¹æ–‡æœ¬å†…å®¹</p>
      <div class="privacy-notice">ğŸ”’ æ‰€æœ‰å¤„ç†å‡åœ¨æœ¬åœ°å®Œæˆï¼Œæ•°æ®ä¸ä¼šä¸Šä¼ </div>
    </header>

    <div class="card">
      <div class="card-title">æŸ¥æ‰¾ä¸æ›¿æ¢</div>
      <div style="display: grid; gap: 10px;">
        <div>
          <label style="display: block; margin-bottom: 5px; font-weight: 500;">æŸ¥æ‰¾å†…å®¹</label>
          <input type="text" id="searchText" class="input" placeholder="è¾“å…¥è¦æŸ¥æ‰¾çš„æ–‡æœ¬æˆ–æ­£åˆ™è¡¨è¾¾å¼" style="width: 100%;">
        </div>
        <div>
          <label style="display: block; margin-bottom: 5px; font-weight: 500;">æ›¿æ¢ä¸º</label>
          <input type="text" id="replaceText" class="input" placeholder="è¾“å…¥æ›¿æ¢åçš„æ–‡æœ¬" style="width: 100%;">
        </div>
      </div>
      <div class="search-options">
        <label style="display: flex; align-items: center; gap: 5px;">
          <input type="checkbox" id="useRegex">
          <span>ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼</span>
        </label>
        <label style="display: flex; align-items: center; gap: 5px;">
          <input type="checkbox" id="caseSensitive">
          <span>åŒºåˆ†å¤§å°å†™</span>
        </label>
      </div>
    </div>

    <div class="dual-editor">
      <div class="card">
        <div class="card-title">è¾“å…¥æ–‡æœ¬</div>
        <div class="editor-container">
          <textarea id="input" class="editor" placeholder="åœ¨æ­¤è¾“å…¥æˆ–ç²˜è´´æ–‡æœ¬..."></textarea>
        </div>
        <div class="btn-group">
          <button class="btn btn-primary" onclick="findText()">æŸ¥æ‰¾</button>
          <button class="btn btn-primary" onclick="replaceText()">æ›¿æ¢å…¨éƒ¨</button>
          <button class="btn btn-secondary" onclick="clearInput()">æ¸…ç©º</button>
        </div>
      </div>

      <div class="card">
        <div class="card-title">å¤„ç†ç»“æœ</div>
        <div class="editor-container">
          <textarea id="output" class="editor" readonly placeholder="å¤„ç†ç»“æœå°†æ˜¾ç¤ºåœ¨è¿™é‡Œ..."></textarea>
        </div>
        <div class="btn-group">
          <button class="btn btn-success" onclick="copyResult()">å¤åˆ¶ç»“æœ</button>
        </div>
        <div id="stats" class="stats"></div>
      </div>
    </div>
  </div>

  <script type="module">
    import { showMessage, copyToClipboard, updateStats } from './shared/components.js';

    window.showMessage = showMessage;
    window.copyToClipboard = copyToClipboard;
    window.updateStats = updateStats;

    /**
     * æŸ¥æ‰¾åŒ¹é…é¡¹
     */
    function findMatches(text, pattern, options = {}) {
      const { caseSensitive = false, useRegex = false } = options;
      
      try {
        let regex;
        if (useRegex) {
          const flags = caseSensitive ? 'g' : 'gi';
          regex = new RegExp(pattern, flags);
        } else {
          const escapedPattern = pattern.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
          const flags = caseSensitive ? 'g' : 'gi';
          regex = new RegExp(escapedPattern, flags);
        }
        
        const matches = [...text.matchAll(regex)];
        return {
          count: matches.length,
          positions: matches.map(m => m.index)
        };
      } catch (error) {
        throw new Error('æ— æ•ˆçš„æ­£åˆ™è¡¨è¾¾å¼');
      }
    }

    /**
     * æ›¿æ¢å…¨éƒ¨
     */
    function replaceAll(text, pattern, replacement, options = {}) {
      const { caseSensitive = false, useRegex = false } = options;
      
      try {
        let regex;
        if (useRegex) {
          const flags = caseSensitive ? 'g' : 'gi';
          regex = new RegExp(pattern, flags);
        } else {
          const escapedPattern = pattern.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
          const flags = caseSensitive ? 'g' : 'gi';
          regex = new RegExp(escapedPattern, flags);
        }
        
        return text.replace(regex, replacement);
      } catch (error) {
        throw new Error('æ— æ•ˆçš„æ­£åˆ™è¡¨è¾¾å¼');
      }
    }

    /**
     * æŸ¥æ‰¾æ–‡æœ¬
     */
    window.findText = function() {
      const input = document.getElementById('input').value;
      const searchText = document.getElementById('searchText').value;
      const useRegex = document.getElementById('useRegex').checked;
      const caseSensitive = document.getElementById('caseSensitive').checked;
      
      if (!input.trim()) {
        showMessage('error', 'è¯·è¾“å…¥è¦æŸ¥æ‰¾çš„æ–‡æœ¬');
        return;
      }
      
      if (!searchText) {
        showMessage('error', 'è¯·è¾“å…¥æŸ¥æ‰¾å†…å®¹');
        return;
      }
      
      try {
        const result = findMatches(input, searchText, { caseSensitive, useRegex });
        
        document.getElementById('output').value = input;
        updateStats({
          'æ‰¾åˆ°åŒ¹é…': `${result.count} å¤„`,
          'æŸ¥æ‰¾æ¨¡å¼': useRegex ? 'æ­£åˆ™è¡¨è¾¾å¼' : 'æ™®é€šæ–‡æœ¬',
          'å¤§å°å†™': caseSensitive ? 'åŒºåˆ†' : 'ä¸åŒºåˆ†'
        }, document.getElementById('stats'));
        
        if (result.count > 0) {
          showMessage('success', `æ‰¾åˆ° ${result.count} å¤„åŒ¹é…`);
        } else {
          showMessage('info', 'æœªæ‰¾åˆ°åŒ¹é…é¡¹');
        }
      } catch (error) {
        showMessage('error', error.message);
      }
    };

    /**
     * æ›¿æ¢æ–‡æœ¬
     */
    window.replaceText = function() {
      const input = document.getElementById('input').value;
      const searchText = document.getElementById('searchText').value;
      const replaceText = document.getElementById('replaceText').value;
      const useRegex = document.getElementById('useRegex').checked;
      const caseSensitive = document.getElementById('caseSensitive').checked;
      
      if (!input.trim()) {
        showMessage('error', 'è¯·è¾“å…¥è¦å¤„ç†çš„æ–‡æœ¬');
        return;
      }
      
      if (!searchText) {
        showMessage('error', 'è¯·è¾“å…¥æŸ¥æ‰¾å†…å®¹');
        return;
      }
      
      try {
        const beforeCount = findMatches(input, searchText, { caseSensitive, useRegex }).count;
        const result = replaceAll(input, searchText, replaceText, { caseSensitive, useRegex });
        
        document.getElementById('output').value = result;
        updateStats({
          'æ›¿æ¢æ¬¡æ•°': beforeCount,
          'æŸ¥æ‰¾æ¨¡å¼': useRegex ? 'æ­£åˆ™è¡¨è¾¾å¼' : 'æ™®é€šæ–‡æœ¬',
          'å¤§å°å†™': caseSensitive ? 'åŒºåˆ†' : 'ä¸åŒºåˆ†'
        }, document.getElementById('stats'));
        
        showMessage('success', `å·²æ›¿æ¢ ${beforeCount} å¤„`);
      } catch (error) {
        showMessage('error', error.message);
      }
    };

    window.clearInput = function() {
      document.getElementById('input').value = '';
      document.getElementById('output').value = '';
      document.getElementById('searchText').value = '';
      document.getElementById('replaceText').value = '';
      document.getElementById('stats').innerHTML = '';
    };

    window.copyResult = function() {
      const output = document.getElementById('output').value;
      if (!output) {
        showMessage('error', 'æ²¡æœ‰å¯å¤åˆ¶çš„å†…å®¹');
        return;
      }
      copyToClipboard(output);
    };

    // å¯¼å‡ºä¾›æµ‹è¯•ä½¿ç”¨
    window.findMatches = findMatches;
    window.replaceAll = replaceAll;
  </script>
</body>
</html>
