<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Markdown / HTML è½¬æ¢ - ä»£ç å·¥å…·å¥—ä»¶</title>
    <link rel="stylesheet" href="./shared/styles.css">
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/turndown/dist/turndown.js"></script>
</head>
<body>
    <div class="container">
        <div class="header">
            <a href="../tooles/index.html" class="back-link">â† è¿”å›å·¥å…·ç®±</a>
            <h1>Markdown / HTML è½¬æ¢</h1>
            <p>å°† Markdown è½¬æˆ HTMLï¼Œæˆ–åå‘è½¬æ¢ï¼Œå¸¸ç”¨äºæ–‡æ¡£ã€é¡µé¢å†…å®¹å¤„ç†</p>
            <div class="privacy-notice">ğŸ”’ æ‰€æœ‰å¤„ç†å‡åœ¨æœ¬åœ°å®Œæˆï¼Œä¸ä¸Šä¼ åˆ°æœåŠ¡å™¨</div>
        </div>

        <!-- è½¬æ¢æ–¹å‘é€‰æ‹© -->
        <div class="card">
            <div class="radio-group">
                <label class="radio-label">
                    <input type="radio" name="direction" value="md2html" checked>
                    Markdown â†’ HTML
                </label>
                <label class="radio-label">
                    <input type="radio" name="direction" value="html2md">
                    HTML â†’ Markdown
                </label>
            </div>
        </div>

        <!-- ç¼–è¾‘å™¨åŒºåŸŸ -->
        <div class="card">
            <div class="dual-editor">
                <div class="editor-container">
                    <label class="editor-label" id="input-label">è¾“å…¥ Markdown</label>
                    <textarea id="input-editor" class="editor" placeholder="åœ¨æ­¤è¾“å…¥ Markdown å†…å®¹..."></textarea>
                </div>
                <div class="editor-container">
                    <label class="editor-label" id="output-label">è¾“å‡º HTML</label>
                    <textarea id="output-editor" class="editor" readonly placeholder="è½¬æ¢ç»“æœå°†æ˜¾ç¤ºåœ¨è¿™é‡Œ..."></textarea>
                </div>
            </div>

            <div class="btn-group">
                <button class="btn btn-primary" id="convert-btn">è½¬æ¢</button>
                <button class="btn btn-secondary" id="copy-btn">å¤åˆ¶ç»“æœ</button>
                <button class="btn btn-secondary" id="download-btn">ä¸‹è½½æ–‡ä»¶</button>
                <button class="btn btn-danger" id="clear-btn">æ¸…ç©º</button>
            </div>
        </div>

        <!-- å®æ—¶é¢„è§ˆ -->
        <div class="card">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                <h3 class="card-title" style="margin: 0; border: none; padding: 0;">å®æ—¶é¢„è§ˆ</h3>
                <label class="checkbox-label">
                    <input type="checkbox" id="live-preview" checked>
                    å¯ç”¨å®æ—¶é¢„è§ˆ
                </label>
            </div>
            <div id="preview" class="preview"></div>
        </div>
    </div>

    <script src="./shared/utils.js"></script>
    <script src="./shared/components.js"></script>
    <script>
        class MarkdownHTMLTool {
            constructor() {
                this.inputEditor = document.getElementById('input-editor');
                this.outputEditor = document.getElementById('output-editor');
                this.preview = document.getElementById('preview');
                this.direction = 'md2html';
                this.fileHandler = new FileHandler();
                
                this._bindEvents();
                this._updateLabels();
            }

            _bindEvents() {
                // è½¬æ¢æ–¹å‘åˆ‡æ¢
                document.querySelectorAll('input[name="direction"]').forEach(radio => {
                    radio.addEventListener('change', (e) => {
                        this.direction = e.target.value;
                        this._updateLabels();
                        this._clearAll();
                    });
                });

                // è½¬æ¢æŒ‰é’®
                document.getElementById('convert-btn').addEventListener('click', () => {
                    this.convert();
                });

                // å¤åˆ¶æŒ‰é’®
                document.getElementById('copy-btn').addEventListener('click', async () => {
                    const output = this.outputEditor.value;
                    if (!output) {
                        CodeUtils.showWarning('æ²¡æœ‰å¯å¤åˆ¶çš„å†…å®¹');
                        return;
                    }
                    await this.fileHandler.copyToClipboard(output);
                });

                // ä¸‹è½½æŒ‰é’®
                document.getElementById('download-btn').addEventListener('click', () => {
                    this.download();
                });

                // æ¸…ç©ºæŒ‰é’®
                document.getElementById('clear-btn').addEventListener('click', () => {
                    this._clearAll();
                });

                // å®æ—¶é¢„è§ˆ
                this.inputEditor.addEventListener('input', () => {
                    if (document.getElementById('live-preview').checked) {
                        this.convert();
                    }
                });

                // é¢„è§ˆå¼€å…³
                document.getElementById('live-preview').addEventListener('change', (e) => {
                    if (e.target.checked) {
                        this.convert();
                    }
                });
            }

            _updateLabels() {
                const inputLabel = document.getElementById('input-label');
                const outputLabel = document.getElementById('output-label');
                
                if (this.direction === 'md2html') {
                    inputLabel.textContent = 'è¾“å…¥ Markdown';
                    outputLabel.textContent = 'è¾“å‡º HTML';
                    this.inputEditor.placeholder = 'åœ¨æ­¤è¾“å…¥ Markdown å†…å®¹...\n\nä¾‹å¦‚ï¼š\n# æ ‡é¢˜\n\nè¿™æ˜¯ä¸€æ®µ**ç²—ä½“**æ–‡æœ¬ã€‚\n\n- åˆ—è¡¨é¡¹1\n- åˆ—è¡¨é¡¹2';
                } else {
                    inputLabel.textContent = 'è¾“å…¥ HTML';
                    outputLabel.textContent = 'è¾“å‡º Markdown';
                    this.inputEditor.placeholder = 'åœ¨æ­¤è¾“å…¥ HTML å†…å®¹...\n\nä¾‹å¦‚ï¼š\n<h1>æ ‡é¢˜</h1>\n<p>è¿™æ˜¯ä¸€æ®µ<strong>ç²—ä½“</strong>æ–‡æœ¬ã€‚</p>';
                }
            }

            convert() {
                const input = this.inputEditor.value.trim();
                
                if (!input) {
                    this.outputEditor.value = '';
                    this.preview.innerHTML = '<p style="color: #999; text-align: center;">è¾“å…¥å†…å®¹åå°†æ˜¾ç¤ºé¢„è§ˆ</p>';
                    return;
                }

                try {
                    let output;
                    if (this.direction === 'md2html') {
                        output = CodeUtils.markdownToHTML(input);
                        this.preview.innerHTML = output;
                    } else {
                        output = CodeUtils.htmlToMarkdown(input);
                        // é¢„è§ˆ Markdown è½¬æ¢åçš„ HTML
                        this.preview.innerHTML = CodeUtils.markdownToHTML(output);
                    }
                    
                    this.outputEditor.value = output;
                    this.inputEditor.classList.remove('error');
                } catch (error) {
                    this.inputEditor.classList.add('error');
                    CodeUtils.showError('è½¬æ¢å¤±è´¥: ' + error.message);
                }
            }

            download() {
                const output = this.outputEditor.value;
                if (!output) {
                    CodeUtils.showWarning('æ²¡æœ‰å¯ä¸‹è½½çš„å†…å®¹');
                    return;
                }

                const ext = this.direction === 'md2html' ? 'html' : 'md';
                const filename = CodeUtils.generateFilename('converted', ext);
                this.fileHandler.downloadFile(output, filename);
                CodeUtils.showSuccess('æ–‡ä»¶ä¸‹è½½æˆåŠŸ');
            }

            _clearAll() {
                this.inputEditor.value = '';
                this.outputEditor.value = '';
                this.preview.innerHTML = '<p style="color: #999; text-align: center;">è¾“å…¥å†…å®¹åå°†æ˜¾ç¤ºé¢„è§ˆ</p>';
                this.inputEditor.classList.remove('error');
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            new MarkdownHTMLTool();
        });
    </script>
</body>
</html>
