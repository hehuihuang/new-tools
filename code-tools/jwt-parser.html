<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JWT è§£æ/ç¼–ç  - ä»£ç å·¥å…·å¥—ä»¶</title>
    <link rel="stylesheet" href="./shared/styles.css">
</head>
<body>
    <div class="container">
        <div class="header">
            <a href="../tooles/index.html" class="back-link">â† è¿”å›å·¥å…·ç®±</a>
            <h1>JWT è§£æ / ç¼–ç </h1>
            <p>è§£æ JWT (JSON Web Token) å¹¶æŸ¥çœ‹ Headerã€Payload ä¿¡æ¯ï¼Œå¸¸ç”¨äºåå°è°ƒè¯•</p>
            <div class="privacy-notice">ğŸ”’ æ‰€æœ‰å¤„ç†å‡åœ¨æœ¬åœ°å®Œæˆï¼Œä¸ä¸Šä¼ åˆ°æœåŠ¡å™¨</div>
        </div>

        <!-- æ ‡ç­¾é¡µ -->
        <div class="card">
            <div class="tabs">
                <button class="tab active" data-tab="parse">è§£æ JWT</button>
                <button class="tab" data-tab="generate">ç”Ÿæˆ JWT</button>
            </div>

            <!-- è§£æé¢æ¿ -->
            <div id="parse" class="tab-content active">
                <div class="editor-container">
                    <label class="editor-label">è¾“å…¥ JWT Token</label>
                    <textarea id="jwt-input" class="editor" style="min-height: 100px;" placeholder="ç²˜è´´ JWT Token...&#10;ä¾‹å¦‚: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiaWF0IjoxNTE2MjM5MDIyfQ.SflKxwRJSMeKKF2QT4fwpMeJf36POk6yJV_adQssw5c"></textarea>
                </div>
                <div class="btn-group">
                    <button class="btn btn-primary" id="parse-btn">è§£æ</button>
                    <button class="btn btn-danger" id="clear-parse-btn">æ¸…ç©º</button>
                </div>
            </div>

            <!-- ç”Ÿæˆé¢æ¿ -->
            <div id="generate" class="tab-content">
                <div class="dual-editor">
                    <div class="editor-container">
                        <label class="editor-label">Header (JSON)</label>
                        <textarea id="header-input" class="editor" style="min-height: 120px;" placeholder='{"alg": "HS256", "typ": "JWT"}'></textarea>
                    </div>
                    <div class="editor-container">
                        <label class="editor-label">Payload (JSON)</label>
                        <textarea id="payload-input" class="editor" style="min-height: 120px;" placeholder='{"sub": "1234567890", "name": "John Doe", "iat": 1516239022}'></textarea>
                    </div>
                </div>
                <div class="btn-group">
                    <button class="btn btn-primary" id="generate-btn">ç”Ÿæˆ JWT</button>
                    <button class="btn btn-danger" id="clear-generate-btn">æ¸…ç©º</button>
                </div>
            </div>
        </div>

        <!-- è§£æç»“æœ -->
        <div class="card" id="result-section" style="display: none;">
            <h3 class="card-title">è§£æç»“æœ</h3>
            
            <!-- è¿‡æœŸçŠ¶æ€ -->
            <div id="expiry-status" style="display: none; margin-bottom: 15px; padding: 10px; border-radius: 8px;"></div>

            <div class="dual-editor">
                <div class="editor-container">
                    <label class="editor-label" style="color: #e74c3c;">Header</label>
                    <textarea id="header-output" class="editor" style="min-height: 150px;" readonly></textarea>
                </div>
                <div class="editor-container">
                    <label class="editor-label" style="color: #9b59b6;">Payload</label>
                    <textarea id="payload-output" class="editor" style="min-height: 150px;" readonly></textarea>
                </div>
            </div>

            <div class="editor-container" style="margin-top: 15px;">
                <label class="editor-label" style="color: #3498db;">Signature</label>
                <textarea id="signature-output" class="editor" style="min-height: 60px;" readonly></textarea>
            </div>
        </div>

        <!-- ç”Ÿæˆç»“æœ -->
        <div class="card" id="generated-section" style="display: none;">
            <h3 class="card-title">ç”Ÿæˆçš„ JWT (æœªç­¾å)</h3>
            <div class="editor-container">
                <textarea id="generated-output" class="editor" style="min-height: 80px;" readonly></textarea>
            </div>
            <div class="btn-group">
                <button class="btn btn-secondary" id="copy-generated-btn">å¤åˆ¶åˆ°å‰ªè´´æ¿</button>
            </div>
            <p style="color: #f39c12; margin-top: 10px; font-size: 0.9rem;">
                âš ï¸ æ³¨æ„ï¼šæ­¤å·¥å…·ç”Ÿæˆçš„æ˜¯æœªç­¾åçš„ JWTï¼Œä»…ç”¨äºæµ‹è¯•ç›®çš„ã€‚ç”Ÿäº§ç¯å¢ƒè¯·ä½¿ç”¨æœåŠ¡ç«¯ç­¾åã€‚
            </p>
        </div>
    </div>

    <script src="./shared/utils.js"></script>
    <script src="./shared/components.js"></script>
    <script>
        class JWTTool {
            constructor() {
                this.fileHandler = new FileHandler();
                this._bindEvents();
            }

            _bindEvents() {
                // æ ‡ç­¾é¡µåˆ‡æ¢
                document.querySelectorAll('.tab').forEach(tab => {
                    tab.addEventListener('click', (e) => {
                        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                        document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                        e.target.classList.add('active');
                        document.getElementById(e.target.dataset.tab).classList.add('active');
                    });
                });

                document.getElementById('parse-btn').addEventListener('click', () => this.parse());
                document.getElementById('generate-btn').addEventListener('click', () => this.generate());
                document.getElementById('clear-parse-btn').addEventListener('click', () => this.clearParse());
                document.getElementById('clear-generate-btn').addEventListener('click', () => this.clearGenerate());
                document.getElementById('copy-generated-btn').addEventListener('click', () => this.copyGenerated());
            }

            parse() {
                const token = document.getElementById('jwt-input').value.trim();
                if (!token) {
                    CodeUtils.showWarning('è¯·è¾“å…¥ JWT Token');
                    return;
                }

                try {
                    const result = CodeUtils.parseJWT(token);
                    
                    document.getElementById('header-output').value = JSON.stringify(result.header, null, 2);
                    document.getElementById('payload-output').value = JSON.stringify(result.payload, null, 2);
                    document.getElementById('signature-output').value = result.signature;
                    
                    // æ˜¾ç¤ºè¿‡æœŸçŠ¶æ€
                    const expiryStatus = document.getElementById('expiry-status');
                    if (result.expiresAt) {
                        expiryStatus.style.display = 'block';
                        if (result.isExpired) {
                            expiryStatus.style.backgroundColor = '#fdf2f2';
                            expiryStatus.style.color = '#e74c3c';
                            expiryStatus.innerHTML = `âš ï¸ Token å·²è¿‡æœŸ<br>è¿‡æœŸæ—¶é—´: ${result.expiresAt.toLocaleString()}`;
                        } else {
                            expiryStatus.style.backgroundColor = '#e8f8f5';
                            expiryStatus.style.color = '#27ae60';
                            expiryStatus.innerHTML = `âœ“ Token æœ‰æ•ˆ<br>è¿‡æœŸæ—¶é—´: ${result.expiresAt.toLocaleString()}`;
                        }
                    } else {
                        expiryStatus.style.display = 'none';
                    }

                    document.getElementById('result-section').style.display = 'block';
                    document.getElementById('jwt-input').classList.remove('error');
                    CodeUtils.showSuccess('JWT è§£ææˆåŠŸ');
                } catch (error) {
                    document.getElementById('jwt-input').classList.add('error');
                    CodeUtils.showError(error.message);
                }
            }

            generate() {
                const headerInput = document.getElementById('header-input').value.trim();
                const payloadInput = document.getElementById('payload-input').value.trim();

                if (!headerInput || !payloadInput) {
                    CodeUtils.showWarning('è¯·è¾“å…¥ Header å’Œ Payload');
                    return;
                }

                try {
                    const header = JSON.parse(headerInput);
                    const payload = JSON.parse(payloadInput);
                    const jwt = CodeUtils.generateJWT(header, payload);
                    
                    document.getElementById('generated-output').value = jwt;
                    document.getElementById('generated-section').style.display = 'block';
                    CodeUtils.showSuccess('JWT ç”ŸæˆæˆåŠŸ');
                } catch (error) {
                    CodeUtils.showError('JSON æ ¼å¼é”™è¯¯: ' + error.message);
                }
            }

            clearParse() {
                document.getElementById('jwt-input').value = '';
                document.getElementById('jwt-input').classList.remove('error');
                document.getElementById('result-section').style.display = 'none';
            }

            clearGenerate() {
                document.getElementById('header-input').value = '';
                document.getElementById('payload-input').value = '';
                document.getElementById('generated-section').style.display = 'none';
            }

            async copyGenerated() {
                const output = document.getElementById('generated-output').value;
                if (!output) {
                    CodeUtils.showWarning('æ²¡æœ‰å¯å¤åˆ¶çš„å†…å®¹');
                    return;
                }
                await this.fileHandler.copyToClipboard(output);
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            new JWTTool();
        });
    </script>
</body>
</html>
