<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é“¾æ¥è¯Šæ–­å·¥å…·</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 900px;
            margin: 30px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .card {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        h1 { color: #333; }
        h2 { color: #4a90e2; margin-top: 0; }
        .status { padding: 10px; border-radius: 4px; margin: 10px 0; }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .warning { background: #fff3cd; color: #856404; }
        button {
            background: #4a90e2;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover { background: #357abd; }
        .link-test {
            padding: 10px;
            margin: 5px 0;
            background: #f9f9f9;
            border-left: 3px solid #ddd;
        }
        .link-test.ok { border-left-color: #28a745; }
        .link-test.fail { border-left-color: #dc3545; }
        code {
            background: #f4f4f4;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: monospace;
        }
    </style>
</head>
<body>
    <h1>ğŸ” PDF å·¥å…·é“¾æ¥è¯Šæ–­</h1>

    <div class="card">
        <h2>å½“å‰é¡µé¢ä¿¡æ¯</h2>
        <p><strong>å½“å‰ URL:</strong> <code id="current-url"></code></p>
        <p><strong>åè®®:</strong> <code id="protocol"></code></p>
        <p><strong>ä¸»æœº:</strong> <code id="host"></code></p>
        <div id="protocol-warning"></div>
    </div>

    <div class="card">
        <h2>é“¾æ¥æµ‹è¯•</h2>
        <p>ç‚¹å‡»æŒ‰é’®æµ‹è¯•æ‰€æœ‰ PDF å·¥å…·é“¾æ¥æ˜¯å¦å¯è®¿é—®ï¼š</p>
        <button onclick="testLinks()">å¼€å§‹æµ‹è¯•</button>
        <button onclick="openTestPage()">æ‰“å¼€æµ‹è¯•é¡µé¢</button>
        <div id="test-results"></div>
    </div>

    <div class="card">
        <h2>è§£å†³æ–¹æ¡ˆ</h2>
        <div id="solutions"></div>
    </div>

    <script>
        // æ˜¾ç¤ºå½“å‰é¡µé¢ä¿¡æ¯
        document.getElementById('current-url').textContent = window.location.href;
        document.getElementById('protocol').textContent = window.location.protocol;
        document.getElementById('host').textContent = window.location.host || '(æœ¬åœ°æ–‡ä»¶)';

        // æ£€æŸ¥åè®®
        if (window.location.protocol === 'file:') {
            document.getElementById('protocol-warning').innerHTML = `
                <div class="status warning">
                    <strong>âš ï¸ è­¦å‘Š:</strong> æ‚¨æ­£åœ¨ä½¿ç”¨ file:// åè®®ç›´æ¥æ‰“å¼€æ–‡ä»¶ã€‚
                    è¿™å¯èƒ½å¯¼è‡´è·¨æ–‡ä»¶å¤¹é“¾æ¥æ— æ³•æ­£å¸¸å·¥ä½œã€‚
                </div>
            `;
        } else {
            document.getElementById('protocol-warning').innerHTML = `
                <div class="status success">
                    <strong>âœ… è‰¯å¥½:</strong> æ‚¨æ­£åœ¨ä½¿ç”¨ Web æœåŠ¡å™¨ (${window.location.protocol})
                </div>
            `;
        }

        // æµ‹è¯•é“¾æ¥
        async function testLinks() {
            const links = [
                { name: 'PDF é¢„è§ˆ', path: 'pdf-tools/pdf-preview.html' },
                { name: 'PDF åˆå¹¶', path: 'pdf-tools/pdf-merge.html' },
                { name: 'PDF æ‹†åˆ†', path: 'pdf-tools/pdf-split.html' },
                { name: 'PDF é‡æ’', path: 'pdf-tools/pdf-reorder.html' },
                { name: 'PDF æ°´å°', path: 'pdf-tools/pdf-watermark.html' },
                { name: 'PDF æ‰¹æ³¨', path: 'pdf-tools/pdf-annotate.html' },
                { name: 'PDF è½¬å›¾ç‰‡', path: 'pdf-tools/pdf-to-image.html' },
                { name: 'PDF å‹ç¼©', path: 'pdf-tools/pdf-compress.html' }
            ];

            const resultsDiv = document.getElementById('test-results');
            resultsDiv.innerHTML = '<p>æµ‹è¯•ä¸­...</p>';

            let html = '<h3>æµ‹è¯•ç»“æœ:</h3>';
            let allOk = true;

            for (const link of links) {
                try {
                    const response = await fetch(link.path, { method: 'HEAD' });
                    if (response.ok) {
                        html += `<div class="link-test ok">âœ… ${link.name}: <a href="${link.path}" target="_blank">å¯è®¿é—®</a></div>`;
                    } else {
                        html += `<div class="link-test fail">âŒ ${link.name}: æ— æ³•è®¿é—® (${response.status})</div>`;
                        allOk = false;
                    }
                } catch (error) {
                    html += `<div class="link-test fail">âŒ ${link.name}: æ— æ³•è®¿é—® (${error.message})</div>`;
                    allOk = false;
                }
            }

            resultsDiv.innerHTML = html;
            showSolutions(!allOk);
        }

        function showSolutions(hasProblems) {
            const solutionsDiv = document.getElementById('solutions');
            
            if (!hasProblems && window.location.protocol !== 'file:') {
                solutionsDiv.innerHTML = `
                    <div class="status success">
                        <strong>âœ… ä¸€åˆ‡æ­£å¸¸!</strong> æ‰€æœ‰é“¾æ¥éƒ½å¯ä»¥æ­£å¸¸è®¿é—®ã€‚
                    </div>
                `;
                return;
            }

            solutionsDiv.innerHTML = `
                <h3>æ¨èè§£å†³æ–¹æ¡ˆ:</h3>
                
                <div class="status warning">
                    <h4>æ–¹æ³• 1: ä½¿ç”¨ Python å¯åŠ¨æœ¬åœ°æœåŠ¡å™¨ï¼ˆæ¨èï¼‰</h4>
                    <p>åœ¨é¡¹ç›®æ ¹ç›®å½•æ‰“å¼€å‘½ä»¤è¡Œï¼Œè¿è¡Œï¼š</p>
                    <code>python -m http.server 8000</code>
                    <p>ç„¶åè®¿é—®: <a href="http://localhost:8000/diagnose.html" target="_blank">http://localhost:8000/diagnose.html</a></p>
                </div>

                <div class="status warning">
                    <h4>æ–¹æ³• 2: ä½¿ç”¨ VS Code Live Server</h4>
                    <ol>
                        <li>åœ¨ VS Code ä¸­å®‰è£… "Live Server" æ‰©å±•</li>
                        <li>å³é”®ç‚¹å‡» HTML æ–‡ä»¶</li>
                        <li>é€‰æ‹© "Open with Live Server"</li>
                    </ol>
                </div>

                <div class="status warning">
                    <h4>æ–¹æ³• 3: ä½¿ç”¨ Node.js http-server</h4>
                    <p>å®‰è£…å¹¶è¿è¡Œï¼š</p>
                    <code>npm install -g http-server</code><br>
                    <code>http-server -p 8000</code>
                </div>

                <div class="status warning">
                    <h4>æ–¹æ³• 4: åŒå‡»è¿è¡Œæ‰¹å¤„ç†æ–‡ä»¶</h4>
                    <p>åŒå‡»é¡¹ç›®æ ¹ç›®å½•çš„ <code>start-server.bat</code> æ–‡ä»¶</p>
                </div>
            `;
        }

        function openTestPage() {
            window.open('test-links.html', '_blank');
        }

        // é¡µé¢åŠ è½½æ—¶æ˜¾ç¤ºåˆå§‹è§£å†³æ–¹æ¡ˆ
        if (window.location.protocol === 'file:') {
            showSolutions(true);
        }
    </script>
</body>
</html>
